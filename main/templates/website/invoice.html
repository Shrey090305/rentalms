{% extends 'base.html' %}

{% block title %}Invoice {{ invoice.invoice_number }} - RentEase{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="card">
        <div class="card-body p-5">
            <!-- Invoice Header -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <h2><i class="bi bi-box-seam"></i> RentEase</h2>
                    <p class="mb-0">Rental Management System</p>
                    <p class="mb-0">info@rentease.com</p>
                    <p>+91 1234567890</p>
                </div>
                <div class="col-md-6 text-end">
                    <h3>INVOICE</h3>
                    <p class="mb-0"><strong>Invoice #:</strong> {{ invoice.invoice_number }}</p>
                    <p class="mb-0"><strong>Date:</strong> {{ invoice.created_at|date:"M d, Y" }}</p>
                    <p><strong>Status:</strong> 
                        <span class="badge bg-{% if invoice.status == 'paid' %}success{% elif invoice.status == 'draft' %}secondary{% else %}warning{% endif %}">
                            {{ invoice.get_status_display }}
                        </span>
                    </p>
                </div>
            </div>
            
            <hr>
            
            <!-- Customer Info -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <h5>Bill To:</h5>
                    <p class="mb-0"><strong>{{ invoice.order.customer.company_name }}</strong></p>
                    <p class="mb-0">{{ invoice.order.customer.username }}</p>
                    <p class="mb-0">GSTIN: {{ invoice.order.customer.gstin }}</p>
                    <p>{{ invoice.order.delivery_address }}, {{ invoice.order.delivery_city }}</p>
                </div>
                <div class="col-md-6">
                    <h5>Order Details:</h5>
                    <p class="mb-0"><strong>Order #:</strong> {{ invoice.order.order_number }}</p>
                    <p><strong>Order Date:</strong> {{ invoice.order.created_at|date:"M d, Y" }}</p>
                </div>
            </div>
            
            <!-- Items Table -->
            <table class="table table-bordered">
                <thead class="table-light">
                    <tr>
                        <th>Item</th>
                        <th>Period</th>
                        <th>Quantity</th>
                        <th>Rate</th>
                        <th class="text-end">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    {% for line in invoice.order.lines.all %}
                        <tr>
                            <td>{{ line.product.name }}</td>
                            <td>
                                <small>
                                    {{ line.start_date|date:"M d" }} - {{ line.end_date|date:"M d, Y" }}
                                </small>
                            </td>
                            <td>{{ line.quantity }}</td>
                            <td>₹{{ line.unit_price }}</td>
                            <td class="text-end">₹{{ line.get_total }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="4" class="text-end"><strong>Subtotal:</strong></td>
                        <td class="text-end">₹{{ invoice.subtotal }}</td>
                    </tr>
                    <tr>
                        <td colspan="4" class="text-end"><strong>GST ({{ invoice.tax_rate }}%):</strong></td>
                        <td class="text-end">₹{{ invoice.tax_amount }}</td>
                    </tr>
                    <tr>
                        <td colspan="4" class="text-end"><strong>Security Deposit:</strong></td>
                        <td class="text-end">₹{{ invoice.security_deposit }}</td>
                    </tr>
                    {% if invoice.late_fee %}
                        <tr>
                            <td colspan="4" class="text-end"><strong>Late Fee:</strong></td>
                            <td class="text-end text-danger">₹{{ invoice.late_fee }}</td>
                        </tr>
                    {% endif %}
                    <tr class="table-primary">
                        <td colspan="4" class="text-end"><h5 class="mb-0">Total:</h5></td>
                        <td class="text-end"><h5 class="mb-0">₹{{ invoice.total_amount }}</h5></td>
                    </tr>
                    <tr>
                        <td colspan="4" class="text-end"><strong>Amount Paid:</strong></td>
                        <td class="text-end text-success">₹{{ invoice.amount_paid }}</td>
                    </tr>
                    <tr>
                        <td colspan="4" class="text-end"><strong>Balance Due:</strong></td>
                        <td class="text-end text-danger"><strong>₹{{ invoice.get_balance }}</strong></td>
                    </tr>
                </tfoot>
            </table>
            
            <div class="mt-4 text-center">
                <a href="{% url 'website:invoice_download' invoice.pk %}" class="btn btn-success me-2">
                    <i class="bi bi-download"></i> Download PDF
                </a>
                <button onclick="window.print()" class="btn btn-primary">
                    <i class="bi bi-printer"></i> Print Invoice
                </button>
                <a href="{% url 'website:order_detail' invoice.order.pk %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Order
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    @media print {
        .btn, nav, footer { display: none !important; }
    }
</style>
{% endblock %}
